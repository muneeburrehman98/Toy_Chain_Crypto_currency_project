<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToyChain | Ultra-Reliable Blockchain Dashboard</title>
    <!-- Tailwind CSS (Relatively reliable CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Alpine.js (Much lighter and more reliable than React+Babel for local files) -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Hashing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top left, #0f172a, #020617);
            color: #f8fafc;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .neo-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }

        .neo-glow-red {
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .mining-animate {
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            background-size: 200% 100%;
            animation: mining 1.5s infinite linear;
        }

        @keyframes mining {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body x-data="blockchainApp" x-cloak>

    <div class="p-4 md:p-8 max-w-[1600px] mx-auto min-h-screen">
        <!-- Header -->
        <header class="flex justify-between items-center mb-12">
            <div>
                <h1
                    class="text-4xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
                    TOYCHAIN</h1>
                <p class="text-slate-400 text-sm tracking-wide mt-1">Universal Blockchain Dashboard</p>
            </div>
            <div class="flex gap-4">
                <div class="px-4 py-2 rounded-full flex items-center gap-2 glass border"
                    :class="isEntireChainValid ? 'border-green-500/30' : 'border-red-500/30 neo-glow-red'">
                    <div class="w-2 h-2 rounded-full"
                        :class="isEntireChainValid ? 'bg-green-500 animate-pulse' : 'bg-red-500'"></div>
                    <span class="text-xs font-bold"
                        x-text="isEntireChainValid ? 'NETWORK SECURE' : 'INTEGRITY BREACHED'"></span>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar -->
            <aside class="space-y-6">
                <!-- Stats -->
                <div class="glass rounded-3xl p-6 border-white/5">
                    <h2
                        class="text-xs font-bold uppercase tracking-[0.2em] text-slate-500 mb-6 flex items-center gap-2">
                        <i data-lucide="activity" class="w-4 h-4"></i> Stats
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 bg-white/5 rounded-2xl border border-white/5 text-center">
                            <div class="text-[10px] text-slate-500">Blocks</div>
                            <div class="text-xl font-bold" x-text="chain.length"></div>
                        </div>
                        <div class="p-3 bg-white/5 rounded-2xl border border-white/5 text-center">
                            <div class="text-[10px] text-slate-500">Mempool</div>
                            <div class="text-xl font-bold text-blue-400" x-text="mempool.length"></div>
                        </div>
                    </div>
                </div>

                <!-- Add Tx -->
                <div class="glass rounded-3xl p-6 border-white/5">
                    <h2
                        class="text-xs font-bold uppercase tracking-[0.2em] text-slate-500 mb-6 flex items-center gap-2">
                        <i data-lucide="plus-circle" class="w-4 h-4"></i> New Transaction
                    </h2>
                    <div class="space-y-4">
                        <input x-model="newTx.sender" placeholder="Sender"
                            class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-blue-500/50" />
                        <input x-model="newTx.receiver" placeholder="Receiver"
                            class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-blue-500/50" />
                        <div class="grid grid-cols-2 gap-2">
                            <input x-model="newTx.amount" type="number" placeholder="Amount"
                                class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-blue-500/50" />
                            <input x-model="newTx.fee" type="number" placeholder="Fee"
                                class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-blue-500/50" />
                        </div>
                        <button @click="addTransaction"
                            class="w-full py-3 bg-blue-600 hover:bg-blue-500 rounded-xl text-sm font-bold transition-all shadow-lg active:scale-95">
                            Queue Tx
                        </button>
                    </div>
                </div>

                <!-- Mining -->
                <div class="glass rounded-3xl p-6 border-white/5 relative overflow-hidden">
                    <div x-show="mining" class="absolute inset-0 mining-animate"></div>
                    <div class="relative z-10">
                        <button @click="mine" :disabled="mining || mempool.length === 0"
                            class="w-full py-4 bg-gradient-to-r from-indigo-600 to-blue-600 disabled:opacity-30 disabled:grayscale rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2">
                            <i data-lucide="pickaxe" class="w-4 h-4" :class="mining ? 'animate-spin' : ''"></i>
                            <span x-text="mining ? 'MINING...' : 'MINE BLOCK'"></span>
                        </button>
                        <p class="text-[10px] text-slate-500 mt-3 text-center">Reward: 50 TC | Difficulty: 2</p>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <div class="lg:col-span-3 space-y-8">
                <!-- Chain -->
                <div class="flex gap-8 overflow-x-auto pb-8 pt-4 items-start">
                    <template x-for="(block, index) in chain" :key="index">
                        <div class="min-w-[320px] p-6 glass rounded-2xl border transition-all duration-500"
                            :class="validArray[index] ? 'border-white/10' : 'border-red-500/50 neo-glow-red'">
                            <div class="flex justify-between mb-4">
                                <span class="text-[10px] uppercase font-bold text-blue-400"
                                    x-text="`Block #${block.index}`"></span>
                                <i :data-lucide="validArray[index] ? 'shield-check' : 'alert-triangle'"
                                    :class="validArray[index] ? 'text-green-400' : 'text-red-400'"></i>
                            </div>
                            <div class="text-xs font-mono truncate mb-4 text-slate-300" x-text="block.hash"></div>

                            <div class="space-y-4">
                                <template x-for="(tx, txIdx) in block.transactions" :key="txIdx">
                                    <div
                                        class="p-2 bg-white/5 rounded-lg border border-white/5 text-[11px] group relative">
                                        <div class="flex justify-between">
                                            <span class="text-slate-500"
                                                x-text="`${tx.sender.slice(0,6)} -> ${tx.receiver.slice(0,6)}`"></span>
                                            <span class="font-bold text-blue-400" x-text="`$${tx.amount}`"></span>
                                        </div>
                                        <button @click="startTamper(index, txIdx)"
                                            class="absolute right-0 top-0 opacity-0 group-hover:opacity-100 p-1 text-red-400 hover:scale-110 transition-all">
                                            <i data-lucide="edit-2" class="w-3 h-3"></i>
                                        </button>
                                    </div>
                                </template>
                            </div>

                            <div class="mt-4 pt-4 border-t border-white/5 text-[10px] space-y-1 text-slate-500">
                                <div class="flex justify-between"><span>Nonce:</span><span x-text="block.nonce"
                                        class="text-blue-400"></span></div>
                                <div class="flex justify-between"><span>Merkle:</span><span
                                        x-text="block.merkleRoot.slice(0,8) + '...'"></span></div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Mempool -->
                <div class="glass rounded-3xl p-8 border-white/5">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-slate-300 font-bold flex items-center gap-2">
                            <i data-lucide="layers" class="w-4 h-4 text-purple-500"></i> Transaction Mempool
                        </h3>
                        <div class="flex gap-2">
                            <span
                                class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-1 rounded-md font-bold uppercase tracking-tighter">Sorted
                                by Fee (Priority)</span>
                        </div>
                    </div>

                    <div x-show="mempool.length === 0"
                        class="py-12 text-center text-slate-600 border-2 border-dashed border-white/5 rounded-2xl">
                        Mempool is empty. Add transactions to see the priority queue in action.
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <template x-for="(tx, index) in mempool" :key="index">
                            <div class="p-4 bg-white/5 rounded-2xl border transition-all duration-300 flex justify-between items-center relative overflow-hidden"
                                :class="index < 3 ? 'border-blue-500/30 neo-glow translate-y-[-2px]' : 'border-white/5 opacity-60'">

                                <!-- Priority Badge -->
                                <div class="absolute top-0 left-0 px-2 py-0.5 text-[8px] font-black uppercase tracking-widest"
                                    :class="index < 3 ? 'bg-blue-500 text-white' : 'bg-slate-700 text-slate-400'">
                                    Rank #<span x-text="index + 1"></span>
                                </div>

                                <div class="pt-2">
                                    <div class="flex items-center gap-2 mb-1">
                                        <div class="w-6 h-6 rounded-full bg-slate-800 flex items-center justify-center text-[10px] font-bold text-slate-400"
                                            x-text="tx.sender[0]"></div>
                                        <div class="text-[11px]">
                                            <div x-text="tx.sender" class="text-slate-300 font-medium leading-none">
                                            </div>
                                            <div class="text-[9px] text-slate-500 mt-0.5">&rarr; <span
                                                    x-text="tx.receiver"></span></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-right pt-2">
                                    <div x-text="`$${tx.amount}`" class="text-sm font-bold text-white"></div>
                                    <div class="flex items-center justify-end gap-1 mt-0.5">
                                        <i data-lucide="trending-up" class="w-2.5 h-2.5 text-blue-400"></i>
                                        <span x-text="`Fee: $${tx.fee}`"
                                            class="text-[10px] font-bold text-blue-400"></span>
                                    </div>
                                </div>

                                <!-- Next Block Indicator -->
                                <template x-if="index < 3">
                                    <div class="absolute bottom-0 right-0 p-1">
                                        <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-ping"></div>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tamper Modal -->
    <div x-show="tamperModal"
        class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm" x-transition>
        <div class="glass max-w-sm w-full p-8 rounded-3xl border-red-500/20" @click.away="tamperModal = false">
            <h3 class="text-xl font-bold mb-2">Simulate Tamper</h3>
            <p class="text-slate-400 text-sm mb-6">Modify transaction data</p>
            <input x-model="tamperValue" type="number"
                class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-lg font-mono mb-4 focus:border-red-500/50 outline-none" />
            <div class="flex gap-2">
                <button @click="applyTamper"
                    class="flex-1 py-3 bg-red-600 rounded-xl font-bold text-sm">CORRUPT</button>
                <button @click="tamperModal = false"
                    class="py-3 px-6 bg-slate-800 rounded-xl text-sm font-bold">CANCEL</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('blockchainApp', () => ({
                chain: [],
                mempool: [],
                mining: false,
                isEntireChainValid: true,
                validArray: [],
                tamperModal: false,
                tamperTarget: null,
                tamperValue: 0,
                newTx: { sender: '', receiver: '', amount: '', fee: '' },

                init() {
                    this.createGenesis();
                    this.updateValidity();
                    this.refreshIcons();
                },

                refreshIcons() {
                    setTimeout(() => { if (window.lucide) window.lucide.createIcons(); }, 50);
                },

                createGenesis() {
                    const tx = { sender: 'System', receiver: 'Genesis', amount: 0, fee: 0, timestamp: Date.now() };
                    const block = this.createBlock(0, "0", [tx]);
                    block.merkleRoot = "GENESIS_ROOT";
                    block.hash = this.calcHash(block);
                    this.chain = [block];
                },

                createBlock(index, prevHash, txs) {
                    const block = {
                        index,
                        previousHash: prevHash,
                        transactions: txs,
                        timestamp: Date.now(),
                        nonce: 0,
                        merkleRoot: this.calcMerkle(txs)
                    };
                    block.hash = this.calcHash(block);
                    return block;
                },

                calcHash(b) {
                    return CryptoJS.SHA256(b.index + b.previousHash + b.timestamp + b.nonce + b.merkleRoot).toString();
                },

                calcMerkle(txs) {
                    if (txs.length === 0) return "0";
                    let hashes = txs.map(t => CryptoJS.SHA256(`${t.sender}${t.receiver}${t.amount}${t.fee}`).toString());
                    while (hashes.length > 1) {
                        let next = [];
                        for (let i = 0; i < hashes.length; i += 2) {
                            if (i + 1 < hashes.length) next.push(CryptoJS.SHA256(hashes[i] + hashes[i + 1]).toString());
                            else next.push(hashes[i]);
                        }
                        hashes = next;
                    }
                    return hashes[0];
                },

                addTransaction() {
                    if (!this.newTx.sender || !this.newTx.amount) return;
                    this.mempool.push({ ...this.newTx, timestamp: Date.now() });
                    this.mempool.sort((a, b) => b.fee - a.fee);
                    this.newTx = { sender: '', receiver: '', amount: '', fee: '' };
                    this.refreshIcons();
                },

                mine() {
                    if (this.mempool.length === 0) return;
                    this.mining = true;
                    setTimeout(() => {
                        const txs = this.mempool.splice(0, 3);
                        txs.push({ sender: 'System', receiver: 'Miner', amount: 50, fee: 0, timestamp: Date.now() });

                        const prev = this.chain[this.chain.length - 1];
                        const block = this.createBlock(this.chain.length, prev.hash, txs);

                        // Simple PoW
                        const target = "00";
                        while (block.hash.substring(0, 2) !== target) {
                            block.nonce++;
                            block.hash = this.calcHash(block);
                        }

                        this.chain.push(block);
                        this.mining = false;
                        this.updateValidity();
                        this.refreshIcons();
                    }, 1500);
                },

                updateValidity() {
                    this.validArray = this.chain.map((block, i) => {
                        if (i === 0) return true;
                        const prev = this.chain[i - 1];
                        const hashValid = block.hash === this.calcHash(block);
                        const linkValid = block.previousHash === prev.hash;
                        const merkleValid = block.merkleRoot === this.calcMerkle(block.transactions);
                        return hashValid && linkValid && merkleValid;
                    });
                    this.isEntireChainValid = this.validArray.every(v => v);
                },

                startTamper(bIdx, tIdx) {
                    this.tamperTarget = { bIdx, tIdx };
                    this.tamperValue = this.chain[bIdx].transactions[tIdx].amount;
                    this.tamperModal = true;
                },

                applyTamper() {
                    const { bIdx, tIdx } = this.tamperTarget;
                    this.chain[bIdx].transactions[tIdx].amount = parseFloat(this.tamperValue);
                    this.tamperModal = false;
                    this.updateValidity();
                    this.refreshIcons();
                }
            }));
        });
    </script>
</body>

</html>